pipeline {
    agent any
    stages {
        stage('Checkout Code') {
            steps {
                git 'https://github.com/RadwaSamirr/radwasamir.git'
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    def imageName = 'radwasamir/simple-html-website'
                    docker.build(imageName, '.') {
                        args '--build-arg BUILD_DATE="$(date -u +\'%Y-%m-%dT%H:%M:%SZ\')"'
                    }
                }
            }
        }
        stage('Run Docker Container (Optional)') {
            steps {
                script {
                    def imageName = 'radwasamir/simple-html-website'
                    def containerName = 'simple-html-container'
                    def portMapping = '80:80'
                    sh "docker stop ${containerName} || true"
                    sh "docker rm ${containerName} || true"
                    sh "docker run --name ${containerName} -p ${portMapping} -d ${imageName}"
                    echo "Docker container '${containerName}' is running on port ${portMapping}"
                }
            }
        }
        stage('Cleanup (Optional)') {
            steps {
                script {
                    def containerName = 'simple-html-container'
                    sh "docker stop ${containerName} || true"
                    sh "docker rm ${containerName} || true"
                }
            }
        }
    }
}
